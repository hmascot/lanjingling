<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>password-retrieval</title>
    <link rel="stylesheet" type="text/css" href="lib/style/bootstrap.min.css">
    <link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="lib/style/style.css">
    <link rel="stylesheet" href="lib/style/mdeia.css" />
    <script type="text/javascript" src="lib/js/jquery.min.js"></script>
    <script type="text/javascript" src="lib/js/bootstrap.min.js"></script>
    <script src="lib/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="lib/js/style.js"></script>
</head>

<body>
    <header class="clearfix">
        <div class="navTop clearfix">
            <div class="topNav">
                <div class="container clearfix">
                    <p class="wechat">
                        <em>wechat</em>
                    </p>
                    <ul class="pull-left">
                        <li class="pull-left">
                            <a href="javascript:void (0)">微信</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="javascript:void (0)">微博</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="javascript:void (0)">掘金</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="javascript:void (0)">知乎</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="javascript:void (0)">QQ</a>
                            <span class="last-bar">|</span>
                        </li>
                    </ul>
                    <ul class="pull-right">
                        <li class="pull-left">
                            <a href="javascript:void (0)">登录</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="Individual-initiation.html">个人入会</a>
                            <span>|</span>
                        </li>
                        <li class="pull-left">
                            <a href="group.html">团体入会</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="subTop">
                <div class="container clearfix">
                    <a href="index.html" class="pull-left subImg" title="">
                        <img src="images/logo.png" alt="" />
                    </a>
                    <div class="navbar-collapse collapse" role="navigation" aria-expanded="false" style="height: 1px;border-color: #101010;">
                        <ul class="pull-right pull-sub-right nav navbar-nav">
                            <li>
                                <a href="">首页</a>
                            </li>
                            <li>
                                <a href="">集团概况</a>
                            </li>
                            <li>
                                <a href="">资讯动态</a>
                            </li>
                            <li>
                                <a href="">业务概览</a>
                            </li>
                            <li>
                                <a href="">人力资源</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--<div class="clearfix"></div>-->
    </header>
    <div class="login password-retrieval clearfix" style="margin-top:5%;">
        <div class="login-box" style="height:500px;">
            <div class="login-title text-center">
                <h1>
                    <small>找回登录密码</small>
                </h1>
            </div>
            <div class="login-content ">
                <div class="form">
                    <form action="#" method="post">
                        <div class="form-group">
                            <div class="col-xs-12  ">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <span class="fa fa-user"></span>
                                    </span>
                                    <input type="text" id="myPhone" name="username" class="form-control" placeholder="请输入手机号码">
                                </div>
                            </div>
                        </div>
                        <em class="tip"></em>
                        <div class="form-group">
                            <div class="col-xs-12  ">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <span class="fa fa-user"></span>
                                    </span>
                                    <input type="text" class="form-control mbVerification" id="mbVerification" value="" placeholder="请输入手机验证码" />
                                    <input type="button" id="getMbverification" class="getMbverification" value="获取验证码">
                                </div>
                            </div>
                        </div>
                        <em class="tip-mbVerification"></em>
                        <div class="form-group">
                            <div class="col-xs-12  ">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <span class="fa fa-lock"></span>
                                    </span>
                                    <input type="password" id="pwd" name="username" class="form-control" placeholder="请设置登录密码">
                                </div>
                            </div>
                        </div>
                        <em class="tip-pass"></em>
                        <div class="form-group">
                            <div class="col-xs-12  ">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <span class="fa fa-lock"></span>
                                    </span>
                                    <input type="password" id="pwds" name="username" class="form-control" placeholder="请确认登录密码">
                                </div>
                            </div>
                        </div>
                        <em class="tip-pwds"></em>
                        <div class="form-group">
                            <div class="col-xs-12  ">
                                <p style="margin-bottom:3%;">为了您的账户安全，请妥善保管账户密码</p>
                            </div>
                        </div>
                        <div class="form-group form-actions">
                            <div class="col-xs-12">
                                <button type="button" id="btn" class="btn btn-block btn-info"> 登录</button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
    <footer class="sec-footer" style="background: #F0F0F0;">
        <div class="container clearfix">
            <div class="row">
                <div class="col-md-4 col-sm-4 col-xs-12 footer-left">
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <h4>
                            <a href="" title="">粮油油脂</a>
                        </h4>
                        <ul>

                            <li>
                                <a href="" title="">粮食基地</a>
                            </li>

                            <li>
                                <a href="" title="">油脂产业</a>
                            </li>

                            <li>
                                <a href="" title="">农业机械</a>
                            </li>

                        </ul>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6">
                        <h4>
                            <a href="" title="">粮油油脂</a>
                        </h4>
                        <ul>

                            <li>
                                <a href="" title="">粮食基地</a>
                            </li>

                            <li>
                                <a href="" title="">油脂产业</a>
                            </li>

                            <li>
                                <a href="" title="">农业机械</a>
                            </li>

                        </ul>
                    </div>
                </div>
                <div class="col-md-8 col-sm-8 col-xs-12 footer-right">
                    <div class="col-md-6 col-sm-6 col-xs-6 footer-right-left">
                        <em>电话:0755-1234567</em>
                        <p>企业管理有限公司</p>
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-6 footer-right-right">
                        <img src="images/ewm.png" />
                    </div>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="sec-footer-end">
                <p>Copyright © 2016 112233（深圳）有限公司 版权所有 粤ICP备 05116968号.
                    <a href="">
                        <img src="images/end.png" alt="" title="">
                    </a>
                </p>
            </div>

        </div>
    </footer>
    <script>
        $(function () {
            var flag = false;
            // 手机号验证
            $("#myPhone").blur(function () {
                var reg = /^1[34578]\d{9}$/;
                var telephone = this.value.replace(/ /g, "");
                var istrue = reg.test(telephone);
                if (!istrue) {
                    $(".tip").html("请输入正确格式的手机号码");
                    flag = false;
                } else {
                    console.log("手机号码格式输入正确");
                    $(".tip").html("");
                    flag = true;
                }
            });
            // 获取验证码
            var wait = 60;

            function time(o) {
                if (wait == 0) {
                    o.removeAttribute("disabled");
                    o.value = "获取验证码";
                    wait = 60;
                } else {
                    o.setAttribute("disabled", true);
                    o.value = "重新发送(" + wait + ")";
                    wait--;
                    setTimeout(function () {
                            time(o)
                        },
                        1000)
                }
            }

            $("#getMbverification").click(function () {
                if ($("#myPhone").val() == "") {
                    $(".tip").html("请输入手机号码");
                } else {
                    get_repwdCaptcha(mobileNo);	
                    time(this);

                }
            });

            // 密码验证
            $("#pwd").blur(function () {
                var reg = /^[A-Za-z0-9.*]{6,16}$/;
                var pass = $("#pwd").val();
                var istrue = reg.test(pass);
                if (!istrue) {
                    $(".tip-pass").html("请输入6-16位字母、数字或符号");
                    flag = false;
                } else {
                    $(".tip-pass").html("");
                    flag = true;
                }
            });

            // 再次输入密码
            $("#pwds").blur(function () {
                if ($("#pwd").val() != $("#pwds").val()) {
                    $(".tip-pwds").html("密码不对，请重新输入");
                    flag = false;
                } else {
                    $(".tip-pwds").html("");
                    flag = true;
                }
            });

            $("#btn").click(function () {
                if ($("#myPhone").val() == "") {
                    $(".tip").html("请输入正确格式的手机号码");
                    flag = false;
                } else if ($("#pwd").val() == "") {
                    $(".tip-pass").html("请输入6-16位字母、数字或符号");
                    flag = false;
                } else if ($("#pwds").val() == "") {
                    $(".tip-pwds").html("请输入6-16位字母、数字或符号");
                    flag = false;
                } else if ($("#mbVerification").val() == "") {
                    $(".tip-mbVerification").html("请输入验证码");
                    flag = false;
                } else {
                    var mobile = $("#myPhone").val();
                    var mbVerification = $("#mbVerification").val();
                    var pwd = $("#pwd").val();
                    var pwds = $("#pwds").val();
                    var url = '/index.php/member/login/repwd';
                    $.ajax({
                        //contentType: "application/json; charset=utf-8",
                        url: url,
                        type: 'POST',
                        data: {
                            "mobile": mobile,
                            "mbVerification": mbVerification,
                            "pwd": pwd,
                            "pwds": pwds
                        },
                        dataType: 'json',
                        error: function (request) {
                            //alert("服务器繁忙，请联系我们!");
                            succModal();
                            $("#myInfo").html("服务器繁忙，请联系我们!");
                            return false;
                        },
                        success: function (data) {
                            //alert(data);
                            if (data.code == 1) {
                                modal();
                                succModal();
                                $("#myInfo").html(data.msg);
                                //window.location.href = '/';
                                window.setTimeout("window.location='/member/login/login'",
                                    2000);
                            } else {
                                modal();
                                succModal();
                                $("#myInfo").html(data.msg);
                                return false;
                            }
                        }
                    });
                    //$("#btn").attr("type", "submit");

                }
            });

            function get_repwdCaptcha(mobileNo) {
                var url = '/index.php/member/Login/get_repwdCaptcha/mobileNo/' + mobileNo;
                //alert("发送中!");
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    url: url,
                    error: function (request) {
                        //alert("服务器繁忙，请联系我们!");
                        succModal();
                        $("#myInfo").html("服务器繁忙，请联系我们!");
                        return false;
                    },
                    success: function (data) {
                        //alert(data);
                        if (data == 1) {
                            succModal();
                            $("#myInfo").html("短信验证码发送成功");
                            time(this);
                        } else if (data == 3) {
                            succModal();
                            $("#myInfo").html("每天发送验证不超过5次");
                            return false;
                        } else if (data == 4) {
                            succModal();
                            $("#myInfo").html("该手机号码不是会员");
                            return false;
                        } else {
                            succModal();
                            $("#myInfo").html("发送失败，请联系我们");
                            return false;
                        }
                    }
                });
            }
            // $('.refcaptcha').on('click', function () {
            //     $('#getImgcaptcha').get(0).src = ($('#getImgcaptcha').get(0).src + '?=r' + Math.random(
            //         1, 10000));
            // });


        })
    </script>
</body>

</html>